        <%= link_to 'Статистика', '#', class: 'show_statistics' %>

        <div class="statistics">
        	<h4>Колличество посещений:</h4>
        	<p>Дом: <%= session[:house] %><p>
        	<p>Работа: <%= session[:work] %><p>
        	<p>Harat's: <%= session[:harats] %><p>
        </div>
        <div class="wrap">
                <div class="container">
                        <%= image_tag @image %>
                </div>

                <div class="controls">
                    <% if session[:way] != [] %>
                            <% unless session[:way].last == "1" || session[:way].last.nil? %>
	                            <%= form_tag game_url, method: :post do %>
	                                    <%= hidden_field_tag(:step, 1) %>
	                                    <%= submit_tag "Дом" %>
	                            <% end %>
                            <% end %>

                            <% unless session[:way].last == "2" %>
	                            <%= form_tag game_url, method: :post do %>
	                                    <%= hidden_field_tag(:step, 2) %>
	                                    <%= submit_tag "Работа" %>
	                            <% end %>
                            <% end %>

                            <% unless session[:way].last == "3" %>
	                            <%= form_tag game_url, method: :post do %>
	                                    <%= hidden_field_tag(:step, 3) %>
	                                    <%= submit_tag "Harat's" %>
	                            <% end %>
                            <% end %>

                            <%= form_tag game_url, method: :post do %>
                                    <%= hidden_field_tag(:step, params[:step]) %>
                                    <%= submit_tag "Остаться" %>
                            <% end %>
                    <% else %>
                            <%= form_tag game_url, method: :post do %>
                                    <%= submit_tag "Продолжить" %>
                            <% end %>
                    <% end %>

                     <% if session[:way].last == "2" %>
                           <%= button_tag "Пошатать Иванову", id: "shake_Nastya" %>
                     <% end %>
                </div>

       </div>

<div class="footer">
	
	                <p style="display:none" id="pageTextSource">
	                        <%= @guide[0][:text] %>
	                </p>
	
	                <div class="text_output">

	                        <p id="pageText">
	                        </p>
	                </div>
	
	                <div class="guide"><%= image_tag @guide[0][:guide] %></div>
</div>

<script>

var initialText = <%= raw @guide[0][:text].to_json %>;
var closingText = <%= raw @guide[1][:text].to_json %>;

var shakeCount = 0, shakeText = '';

$('button#shake_Nastya').click(
		function(){

			textContainer = $('p#pageTextSource');
				
			switch (shakeCount)
			{
				case 0:
					shakeText = '- Ну, Миша, ну, перестань! Я работаю!';
				break;
				
				case 1:
					shakeText = '- Мунаев, прекрати! Это непотребство!';
				break;

				case 2:
					shakeText = '- Миша, я Никите пожалуюсь! - Никита, чего он мне мешает! Скажи ему!'
				break;

				case 3:
					$('div.guide').html('<%= image_tag "guide_nick_2.png" %>');
					shakeText = '- Продолжай, друг.'
				break;

				case 4:
					$('div.guide').html('<%= image_tag "guide_nastya_2.png" %>');
					shakeText = '=_='
				break;

				default:
					shakeText = ' - Хватит...';
			}
		
		textContainer.html(shakeText);
		show_text();
		shakeCount = shakeCount + 1;

		}
	)


$('a.show_statistics').click(
		function(){
			$('div.statistics').slideToggle();
		}
	)

var textLine = 0;

$('div.guide img').click(
	function(){
		textLine++;
		if ( initialText[textLine] )
			show_text(initialText);
		}
	)


 var source,dest,len,now=0,delay=30,letters=1;

function show_text(text)
{
	source = text[textLine];
	now=0;
    //source = document.getElementById("pageTextSource");
    dest = document.getElementById("pageText");
    dest.innerHTML += '<Br/>';
    //dest.innerHTML = '';
    //len = source.innerHTML.length;
    len = source.length;
    show();
}

function show()
{
    // if ( source.innerHTML.substr(now,letters) == '-') { dest.innerHTML += '<Br/>' }
    //dest.innerHTML += source.innerHTML.substr(now,letters);
    dest.innerHTML += source.substr(now,letters);
    now+=letters;
    if( now < len ){setTimeout("show()",delay);}
}

$(function() {
  	show_text(initialText);
}
)
</script>